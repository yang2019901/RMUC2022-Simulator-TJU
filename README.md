# RMUC2022-Simulator-TJU

[![license](https://img.shields.io/badge/license-Mozilla-green)](./LICENSE)

## 简介

本工程为**RMUC2022赛季**的开源模拟器，由北洋机甲前算法组成员杨铭于2022年7月至2023年6月基于Unity开发。

**灵感来源:**
* DJI裁判系统客户端
* 华南虎Simulator2021

## 功能特性

* **支持单机与联机模式:** 可在本地进行测试，也可通过局域网或IPV6进行联机对战。
* **高精度三维模型:** 包含2022赛季所有机器人的高精度三维模型。
* **真实的物理模拟:** 模拟了机器人的运动、碰撞和射击等物理效果。
* **高度还原的UI:** 参照DJI裁判系统客户端的UI进行制作。

## 目录

- [RMUC2022-Simulator-TJU](#rmuc2022-simulator-tju)
  - [简介](#简介)
  - [功能特性](#功能特性)
  - [目录](#目录)
  - [安装指南](#安装指南)
  - [使用说明](#使用说明)
    - [网络要求](#网络要求)
    - [配置要求](#配置要求)
    - [按键指南](#按键指南)
  - [演示](#演示)
    - [用户登录界面](#用户登录界面)
    - [游玩模式选择](#游玩模式选择)
    - [兵种选择](#兵种选择)
    - [比赛场地](#比赛场地)
  - [贡献指南](#贡献指南)
  - [行为准则](#行为准则)
  - [版本](#版本)
  - [致谢](#致谢)
  - [反馈](#反馈)
  - [许可证](#许可证)

## 安装指南

### 对于普通用户

可直接从本仓库的 **Release** 页面下载预先构建的可执行程序（`RMUC2022-Simulator-Release.zip`）行。

### 对于开发者

1. **开发环境:** Unity Editor 2021.3.8f1c1
2. **打开工程:** 使用UnityHub “打开” -> 选中`Assets/`的父文件夹。
3. **编译:** 第一次打开工程需要编译，所需时间较长，约几分钟至几十分钟。
4. **场景文件:** simulator的场景文件共两个，即选择游玩模式的`Lobby.unity`和实际对抗`BattleField.unity`，位于`Assets/Scenes/`目录下，双击打开后Unity Editor窗口即可呈现场景。
5. **编译设置:** `Ctrl+Shift+B` 更改编译设置（如编译平台等）；`Ctrl+B` 即可打包工程。
6. **环境问题:** 由于开发环境不完全一致，出现报错是正常现象，可Google、联系作者或提Issue。

## 使用说明

simulator可以单机也可联机，联机时房间创建者的电脑为服务器（记作server PC），其他玩家（记作client PC）可通过局域网连接和ipv6连接加入房间。（若不在同一局域网且无ipv6地址，可通过内网穿透等方式连接）。

### 网络要求

server PC和client PC的网络带宽建议不小于1Mb/s，网速占用的理论值约为10Kb/s至20Kb/s。网络延迟应尽可能低，以保证client PC与server PC上机器人的行为一致。（simulator数据汇总于server PC运算，一切数据以server PC上的运算结果为准）

### 配置要求

目前，由于simulator还未应用LOD，场景中三角面个数较多，需要一定算力的CPU和显卡。9代i5+GTX1650笔记本可稳定90帧。

日志文件：日志缓存在路径`.\rmuc_simu_preview_Data\YOUR_LOGS`中，删除后不影响程序运行。

### 按键指南

进入BattleField场景后，各机器人的按键如下：

注1：按`键打开设置界面，选择Quit退出当前比赛，并返回至Lobby。

注2：工程括号内为夹爪模式下的操作，如：r键 => 伸出/缩回救援卡；左shift+r键 => 夹爪开启/关闭吸力。

|       按键       |           步兵（infantry）          |            英雄（hero）             |           工程（engineer）           |            无人机（drone）            |
| :--------------: | :---------------------------------: | :---------------------------------: | :----------------------------------: | :-----------------------------------: |
|       Esc        |            鼠标锁定/解锁            |            鼠标锁定/解锁            |            鼠标锁定/解锁             |             鼠标锁定/解锁             |
| `（Esc下面那个） |            打开设置界面             |            打开设置界面             |             打开设置界面             |             打开设置界面              |
|        o         |            打开补弹界面             |            打开补弹界面             |             打开补弹界面             |             打开补弹界面              |
|     w/a/s/d      |              前后左右               |              前后左右               |       前后左右（夹爪伸缩平移）       |               前后左右                |
|        r         |                  \                  |                  \                  | 伸出/缩回救援卡（夹爪开启/关闭吸力） | 呼叫空中支援，若队伍金币少于300则无效 |
|        c         |            开启/关闭电容            |            开启/关闭电容            |        无  (夹爪向外翻转90度)        |                   \                   |
|        z         |                  \                  |                  \                  |        无 (夹爪向内翻转90度)         |                   \                   |
|        x         |                刹车                 |                刹车                 |                 刹车                 |                   \                   |
|       e/q        |                  \                  |                  \                  |              右转/左转               |               上升/下降               |
|     左shift      |               小陀螺                |               小陀螺                |  按下时为夹爪模式，松开时为普通模式  |                   \                   |
|     鼠标左键     |              发射弹丸               |              发射弹丸               |                  \                   |               发射弹丸                |
|     鼠标右键     | 装甲板自瞄，若r键按下，则为打符自瞄 | 装甲板自瞄，若r键按下，则为打符自瞄 |                  \                   |  装甲板自瞄，若r键按下，则为打符自瞄  |
|     移动鼠标     |              调整视角               |              调整视角               |               调整视角               |               调整视角                |

## 演示

### 用户登录界面

用户在此填写昵称（Player Name），建议不多于六个半角字符以保证显示完整。每次启动时，将默认使用电脑名称作为昵称。

<img src="README.assets\log_in.png" alt="log_in" style="zoom: 67%;" />

### 游玩模式选择

- **Single Player:** 本地离线游玩。
- **Multi Player:** 创建或加入联机房间。
- **Back:** 返回登录界面。

<img src="README.assets\select_mode.png" alt="select_mode" style="zoom:67%;" />

### 兵种选择

- **开始比赛:** 按钮仅对房主可见，点击后切换至 `BattleField` 场景并开始比赛。
- **选择兵种:** 点击兵种两侧的按钮即可选择（红方在左，蓝方在右）。
- **准备状态:** 非房主玩家选择兵种后，按钮将变为 `Cancel Ready`，用于向房主示意已就绪作。此作仅用于提示房主，未就绪状态的玩家不影响房主开始比赛。

<img src="README.assets\select_robot.png" alt="select_robot" style="zoom:67%;" />

### 比赛场地

UI界面模拟了真实的RoboMaster比赛操作界面，并在左下角额外增加了电容和经验指示条，以提供更丰富的状态信息。

<img src="README.assets\in_game1.png" alt="in_game1" style="zoom: 33%;" />

项目使用 `WheelCollider` 模拟车轮的物理特性，能够逼真地再现车辆在复杂地形（如下坡）的侧翻等动态效果。

<img src="README.assets\in_game2.png" alt="in_game2" style="zoom: 33%;" />

## 贡献指南

我们非常欢迎社区的贡献！请遵循以下步骤：

1. Fork 本仓库。
2. 创建您的特性分支 (`git checkout -b feature/AmazingFeature`)。
3. 提交您的更改 (`git commit -m 'Add some AmazingFeature'`)。
4. 推送到分支 (`git push origin feature/AmazingFeature`)。
5. 提交一个 Pull Request。

## 行为准则

为了营造一个开放和热情的环境，我们作为贡献者和维护者保证，无论年龄、体型、残疾、种族、性别认同和表达、经验水平、国籍、个人外表、种族、宗教或性别认同和取向如何，我们项目和社区的参与者都不会受到骚扰。

## 版本

v1.0.0

## 致谢

感谢大疆创新创办的机甲大师系列比赛，其比赛机制新颖而富于挑战、比赛场地美观而科技感十足。simulator的比赛场地相关UI和CG均参照其样式制作，没有DJI精妙设计的比赛机制，simulator无从谈起。

感谢华南虎战队2021年发布的模拟器，那是我接触到的第一款超级对抗赛的模拟器，也让我萌生了从零开发simulator的念头。没有他们先驱性的创想，我也不会产生搭建simulator的意愿和行动。

感谢北洋机甲战队每一位成员，他们无私地提供了2022赛季所有机器人的高精度三维模型，为提高simulator的视觉还原度和物理拟真度做出了重要的贡献。

特别鸣谢舍友张宸睿和曹鸿钰，他们在开发过程和预发布过程中积极参与了simulator的网络连接、多人对抗等测试，并从控制逻辑仿真、三角面优化等方面提供了大量宝贵意见，直接推进了simulator的迭代优化。

## 反馈

如有任何疑问、意见或建议，包括但不限于机制bug、穿模、操作反人类、UI美化等，欢迎联系作者。QQ：1308592371；Email：mingyang2601@outlook.com。

Enjoy it！

## 许可证

该项目根据 Mozilla Public License 2.0 获得许可。
